The authors presented **EndoNuke: Nuclei Detection in Endometrium Samples Dataset** the first open dataset dedicated to automating the scoring process of endometrium immunohistochemistry (IHC) slides, it consists of tiles from endometrium immunohistochemistry slides with the nuclei annotated as points. Several experts with various experience have annotated the dataset. Apart from gathering the data and creating the annotation, they have performed an agreement study and analyzed the distribution of nuclei staining intensity.

## Motivation

One of the primary challenges in medical research and decision-making is the subjective assessment of clinical data, particularly when it involves visual interpretation. Additionally, an integrated approach to evaluating biomedical data is often necessary, requiring the comparison of results from multiple studies. As the number of studies increases, this process becomes more complex. Both issues can be addressed by developing software tools that support medical and clinical decision-making. Such tools are especially crucial in histological examinations, frequently needed for patients diagnosed with infertility. Infertility, defined as the inability to achieve a clinical pregnancy after 12 months or more of regular unprotected intercourse, affects a significant portion of the global population, impacting over 186 million couples worldwide. The receptivity of the endometrium is a critical factor influencing the likelihood of pregnancy. Since the regulation of morphological and functional changes in the endometrium is driven by steroid hormones, studying the number and ratio of high-grade progesterone and estrogen receptors in the stroma and endometrial glands is of particular importance.

Estrogenic activity in the endometrium is primarily mediated through the binding of its nuclear receptors, specifically estrogen receptor alpha and estrogen receptor beta. Progesterone receptors are also expressed in the nuclei of endometrial cells in two functionally distinct isoforms: PR-A and PR-B. The evaluation of the immunohistochemical reaction is conducted separately in the endometrial glands and stroma.

The endometrium is not only a focal point for histopathological diagnosis but also a valuable tissue for experimental manipulation and modeling reproductive diseases using human biomaterial. For example, it can serve as a control tissue for pathologies such as endometriosis or endometriosis-associated ovarian cancer. Thus, comprehensive analysis of the endometrium, including digital methods, is both urgent and crucial. One approach to evaluate these reactions is by calculating a histological score, a cumulative measure representing a sample's receptivity to a given hormone. Manually calculating these scores involves painstakingly counting nuclei with different staining responses, which is error-prone due to the limited fields of view analyzed and the inherent subjectivity of experts. Automating this process can solve these problems and enhance the speed and accuracy of the analysis. To develop models capable of calculating histological scores, rich, representative, and well-labeled datasets are essential. The initial step in computing histological scores is detecting and counting nuclei. Therefore, the dataset should include information about the positions of nuclei and the classification of stroma/epithelium for various patches taken from histological slides.

## Dataset collection

The Commission of Biomedical Ethics at the National Medical Research Center for Obstetrics, Gynecology, and Perinatology, along with the Ministry of Healthcare of the Russian Federation, approved the study in accordance with Good Clinical Practice guidelines and the Declaration of Helsinki. Each participant provided informed consent for the study's purposes, and written consent for publication was obtained from the patient or their relative. Inclusion criteria for the study were reproductive age and the presence of ovarian endometrial cysts, confirmed morphologically after cystectomy. All participants had secondary infertility, decreased ovarian reserve, and unilateral or bilateral ovarian endometrial cysts. The study included 12 patients aged 26 to 40 years, each of whom underwent an aspiration endometrial pipelle biopsy during the mid-proliferation and secretion phases. The biopsies were then fixed in 10% formalin.

## Dataset preparation

Formalin-fixed pipelle endometrial biopsies underwent routine histological processing using the automatic histoprocessor Leica ASP30 and the paraffin embedding station Leica EG1150. From each patient, a series of 4 μm endometrial biopsy sections were prepared for visualizing the general tissue structure and for immunohistochemical analysis. The sections were placed on polylysine-coated glass slides and dried in a drying chamber at 70°C for at least 2 hours. For immunohistochemical analysis, the paraffin sections were deparaffinized in xylene, passed through a series of alcohols of descending concentrations, and then rehydrated in water followed by an appropriate buffer solution. Antigen unmasking and blocking procedures were then performed. The sections were transferred to APK Wash buffer and stained using the immunohistostainer Ventana BenchMark Ultra with the following antibodies: Ventana CONFIRM anti-Progesterone Receptor (PR) Rabbit Monoclonal Primary Antibody (PR-A and PR-B), and Ventana CONFIRM anti-Estrogen Receptor Rabbit Monoclonal Primary Antibody. Immunoperoxidase-conjugated secondary antibodies were used at the dilutions recommended by the manufacturers. Labeling was visualized using diaminobenzidine tetrahydrochloride (DAB), and the sections were counterstained with hematoxylin.
After preparing the slides, the authors sampled tiles of fixed physical sizes of 100 × 100 μm. Due to varying magnifications on the scanner, the pixel sizes of the images differed: 200 × 200 pixels for a 0.5 μm/pixel resolution and 400 × 400 pixels for a 0.25 μm/pixel resolution. Although the tiles were stored in their original sizes, the authors rescaled them to a unified size of 256 × 256 pixels.

The sampling process involved creating a grid on the slide and uniformly sampling tiles from this grid. A simple script detected and excluded tiles that were predominantly background. Since many tiles did not contain any nuclei information, the authors manually filtered some tiles before labeling. To minimize skewing the distribution of the images, only one-third of the dataset was manually filtered. The filtered and unfiltered portions of the dataset can be easily identified using file IDs. Each tile is supplemented with a context image, which is an image with a physical size of 300 × 300 μm, featuring the tile of interest within a contrasting frame.

<img src="https://github.com/dataset-ninja/nuclei-detection/assets/120389559/dfdd09f3-5db1-410d-b472-6e3e361596b0" alt="image" width="800">

<span style="font-size: smaller; font-style: italic;">Context image, raw tile, labeled tile, and a tile with masks.</span>

## Dataset annotation

The annotation process was conducted in three phases using the [CVAT](https://zenodo.org/records/4009388#.YpibNKhByUk) web application tool. For labeling, the "points" tool was used, providing information about nuclei locations while reducing annotation time since the experts did not need to draw bounding boxes or masks.

In the first phase, all experts gathered in a virtual room for a briefing led by a senior pathologist. Following a Q&A session, each of the seven experts independently labeled a fixed set of 10 tiles without communication with each other. After completing the labeling, an additional Q&A session was held. The annotations collected during this phase were used for a "preliminary" agreement study. In the second phase, the bulk of the dataset was created. Each expert annotated their assigned tiles, grouped into tasks of 20 tiles each. As experts completed a task, they received a new one. Communication among experts was facilitated via a chatroom. Additionally, an extra set of 10 tiles was mixed into the first few tasks of each expert to estimate agreement after the second Q&A session from phase 1, forming the "hidden" agreement study.

The third phase mirrored the first but without a briefing or Q&A session, and experts were unaware of this study. Each expert annotated 20 tiles independently to estimate agreement after gaining experience, with minimal communication. These annotations formed the basis for the "posterior" agreement study. After the third phase, the experts continued annotating the dataset following the phase 2 protocol. The entire annotation process spanned one month.

## Agreement study

The initial phase in assessing agreement involves defining the objects under scrutiny. In the authors' study, these objects are nuclei, necessitating their treatment as individual samples. This poses two challenges: firstly, nuclei identified by different experts on the same tiles may not occupy precisely identical positions; secondly, a nucleus labeled by one expert may remain unlabeled by another. The authors tackle these challenges with a specific methodology. For each pair of experts, the authors establish a correspondence between the identified points. If the number of points varies between experts, some points may not find a match. Two strategies are employed to handle this discrepancy. The first involves discarding these unmatched points, allowing for an estimation of agreement on keypoint class labels but not on keypoint numbers. The second strategy assigns an additional class ("background") to all missed points, enabling measurement of both misclassifications and omitted points in a single metric. All agreement studies (***preliminary***, ***hidden***, and ***posterior***) employ both approaches, as each offers valuable insights into annotation quality.

Following point matching, the authors compute the Cohen's kappa statistic for each pair of experts. The mean kappa is then calculated to determine the final agreement measure of the cohort. For each study, three mean kappa values are measured: the first averages over pathologist-pathologist pairs, the second over student-student pairs, and the third over pathologist-student pairs. The first two values provide insights into agreement within two subgroups, while the third assesses the extent to which less experienced annotators agree with more experienced ones.

## Annotation results

The resulting dataset consists of two separate parts: ***agreement*** and ***bulk***. The ***agreement*** consists of 40 tiles with 34,701 nuclei points and was labeled by all experts who participated in the study (three pathologists and four medical students). This part was used for the agreement study and can also be utilized as a test dataset with high quality labels obtained by merging the points from the experienced pathologists. The ***bulk*** part consists of 1740 tiles with 210,419 nuclei labels. Each of these tiles was labeled by a single expert. 268 tiles were labeled by experienced pathologists, while the rest of the dataset was created by medical students.
